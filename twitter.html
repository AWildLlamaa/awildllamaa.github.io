<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Twitter Likes Randomizer</title>
  <style>
    /* CSS styles for your page */
  </style>
</head>
<body>
  <h1>Twitter Likes Randomizer</h1>

  <form id="twitterForm">
    <label for="username">Enter the username:</label>
    <input type="text" id="username" name="username" required>
    <button type="submit">Randomize Tweets</button>
  </form>

  <div id="tweetContainer"></div>

  <script>
    document.addEventListener('DOMContentLoaded', function () {
      const form = document.getElementById('twitterForm');
      const tweetContainer = document.getElementById('tweetContainer');

      form.addEventListener('submit', function (event) {
        event.preventDefault();

        // Clear the previous tweets
        tweetContainer.innerHTML = '';

        // Get the input value
        const username = document.getElementById('username').value.trim();

        // Validate the input value (you can modify the validation as per your requirements)
        if (!username) {
          alert('Please enter a valid Twitter username');
          return;
        }

        // Fetch the likes from the server-side endpoint
        fetch(`/likes/${username}`)
          .then(response => response.json())
          .then(data => {
            if (data.error) {
              alert(`Server Error: ${data.error}`);
              return;
            }

            if (data.length === 0) {
              alert('No liked tweets found');
              return;
            }

            // Filter and randomize tweets with media attachments
            const tweetsWithMedia = data.filter(tweet => tweet.mediaUrl !== '');

            if (tweetsWithMedia.length === 0) {
              alert('No tweets with media found');
              return;
            }

            shuffleArray(tweetsWithMedia);

            // Display the randomized tweets with media
            tweetsWithMedia.forEach(tweet => {
              const tweetElement = document.createElement('div');
              tweetElement.innerHTML = `
                <p>Tweet ID: ${tweet.tweetId}</p>
                <img src="${tweet.mediaUrl}" alt="Tweet Media">
              `;
              tweetContainer.appendChild(tweetElement);
            });
          })
          .catch(error => {
            console.error('Error fetching tweets:', error);
            alert('An error occurred while fetching tweets');
          });
      });

      function shuffleArray(array) {
        // Function to shuffle an array in place using Fisher-Yates algorithm
        for (let i = array.length - 1; i > 0; i--) {
          const j = Math.floor(Math.random() * (i + 1));
          [array[i], array[j]] = [array[j], array[i]];
        }
      }
    });
  </script>
</body>
</html>
